/*! koi-frontend - v1.0.0 - 2016-03-18 */
!function($, window, document, undefined) {
    var Misc = function(a) {};
    Misc.prototype = {
        initialize: function() {},
        formToJson: function(selector) {
            var o = {}, a = [];
            return a = $.prototype.isPrototypeOf(selector) ? selector.serializeArray() : $(selector).serializeArray(), 
            $.each(a, function() {
                o[this.name] !== undefined ? (o[this.name].push || (o[this.name] = [ o[this.name] ]), 
                o[this.name].push(this.value || "")) : o[this.name] = this.value || "";
            }), o;
        },
        isUrl: function(str) {
            var patt = /^(http[s]?:\/\/(www\.)?|ftp:\/\/(www\.)?|www\.){1}([0-9A-Za-z-\.@:%_\+~#=]+)+(\/(.)*)?(\?(.)*)?/i;
            return patt.test(str);
        },
        urlFull: function(route) {
            if (!this.isUrl(document.url)) return route;
            route || (route = "");
            var patt = /^\//;
            return patt.test(route) || (route = "/" + route), document.url + route;
        },
        parseErrors: function(errors) {
            var text = "";
            if (_.isObject(errors)) {
                var listError = "<ul>";
                $.each(errors, function(field, item) {
                    listError += "<li>" + item[0] + "</li>";
                }), listError += "</ul>", text = listError;
            }
            return text;
        },
        setSpinner: function(selector) {
            selector && $(selector).prepend('<div class="overlay"><i class="fa fa-refresh fa-spin"></i></div>');
        },
        removeSpinner: function(selector) {
            var $selector = $(selector).find(".overlay");
            $selector.length && $selector.remove();
        },
        dataTableES: function() {
            return {
                sProcessing: '<div class="overlay"><i class="fa fa-refresh fa-spin"></i></div>',
                sLengthMenu: "Mostrar _MENU_ registros",
                sZeroRecords: "No se encontraron resultados",
                sEmptyTable: "Ningún dato disponible en esta tabla",
                sInfo: "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                sInfoEmpty: "Mostrando registros del 0 al 0 de un total de 0 registros",
                sInfoFiltered: "(filtrado de un total de _MAX_ registros)",
                sInfoPostFix: "",
                sSearch: "Buscar:",
                sUrl: "",
                sInfoThousands: ",",
                sLoadingRecords: "Cargando...",
                oPaginate: {
                    sFirst: "Primero",
                    sLast: "Último",
                    sNext: "Siguiente",
                    sPrevious: "Anterior"
                },
                oAria: {
                    sSortAscending: ": Activar para ordenar la columna de manera ascendente",
                    sSortDescending: ": Activar para ordenar la columna de manera descendente"
                }
            };
        },
        redirect: function(url) {
            url !== undefined && "" != url ? window.location = url : window.location.reload();
        },
        successRedirect: function(msg, url) {
            alertify.success(msg), setTimeout(function() {
                window.Misc.redirect(url);
            }, 500);
        }
    }, window.Misc = new Misc(), window.Misc.initialize();
}(jQuery, this, this.document), app || (app = {}), function(window, document, undefined) {
    app.TerceroModel = Backbone.Model.extend({
        urlRoot: function() {
            return window.Misc.urlFull(Route.route("terceros.index"));
        },
        idAttribute: "id",
        defaults: {}
    });
}(this, this.document), app || (app = {}), function($, window, document, undefined) {
    app.MainActividadView = Backbone.View.extend({
        el: "#actividades-main",
        initialize: function() {
            this.$actividadesSearchTable = this.$("#actividades-search-table"), this.$actividadesSearchTable.DataTable({
                processing: !0,
                serverSide: !0,
                language: window.Misc.dataTableES(),
                ajax: window.Misc.urlFull(Route.route("actividades.index")),
                columns: [ {
                    data: "actividad_codigo",
                    name: "actividad_codigo"
                }, {
                    data: "actividad_nombre",
                    name: "actividad_nombre"
                }, {
                    data: "actividad_categoria",
                    name: "actividad_categoria"
                }, {
                    data: "actividad_tarifa",
                    name: "actividad_tarifa"
                } ]
            });
        }
    });
}(jQuery, this, this.document), app || (app = {}), function($, window, document, undefined) {
    app.ComponentAddressView = Backbone.View.extend({
        el: "body",
        events: {
            "click .btn-address-koi-component": "focusComponent"
        },
        initialize: function() {
            this.$modalComponent = $("#modal-address-component"), this.$("#departamento_codigo").select2({
                language: "es"
            });
        },
        focusComponent: function(e) {
            $("#" + $(e.currentTarget).attr("data-field")).focus();
        },
        addressChanged: function(e) {
            this.inputContent = $(e.currentTarget), this.$modalComponent.modal("show"), console.log(this.inputContent.val("asasdasd"));
        }
    });
}(jQuery, this, this.document), app || (app = {}), function($, window, document, undefined) {
    app.MainDepartamentoView = Backbone.View.extend({
        el: "#departamentos-main",
        initialize: function() {
            this.$departamentosSearchTable = this.$("#departamentos-search-table"), this.$departamentosSearchTable.DataTable({
                processing: !0,
                serverSide: !0,
                language: window.Misc.dataTableES(),
                ajax: window.Misc.urlFull(Route.route("departamentos.index")),
                columns: [ {
                    data: "departamento_codigo",
                    name: "departamento_codigo"
                }, {
                    data: "departamento_nombre",
                    name: "departamento_nombre"
                } ]
            });
        }
    });
}(jQuery, this, this.document), app || (app = {}), function($, window, document, undefined) {
    app.UserLoginView = Backbone.View.extend({
        el: "#login-box",
        initialize: function() {
            this.$loginForm = $("#form-login-account"), this.$loginForm.validator();
        },
        render: function() {}
    });
}(jQuery, this, this.document), app || (app = {}), function($, window, document, undefined) {
    app.MainMunicipioView = Backbone.View.extend({
        el: "#municipios-main",
        initialize: function() {
            this.$municipiosSearchTable = this.$("#municipios-search-table"), this.$municipiosSearchTable.DataTable({
                processing: !0,
                serverSide: !0,
                language: window.Misc.dataTableES(),
                ajax: window.Misc.urlFull(Route.route("municipios.index")),
                columns: [ {
                    data: "departamento_codigo",
                    name: "koi_departamento.departamento_codigo"
                }, {
                    data: "departamento_nombre",
                    name: "departamento_nombre"
                }, {
                    data: "municipio_codigo",
                    name: "municipio_codigo"
                }, {
                    data: "municipio_nombre",
                    name: "municipio_nombre"
                } ]
            });
        }
    });
}(jQuery, this, this.document), app || (app = {}), function($, window, document, undefined) {
    app.CreateTerceroView = Backbone.View.extend({
        el: "#tercero-create",
        events: {
            "change input#tercero_nit": "nitChanged",
            "submit #form-create-tercero": "onStore"
        },
        parameters: {
            callback: ""
        },
        initialize: function(opts) {
            opts !== undefined && _.isObject(opts.parameters) && (this.parameters = $.extend({}, this.parameters, opts.parameters)), 
            this.msgSuccess = "Tercero guardado con exito!", this.listenTo(this.model, "sync", this.responseServer), 
            this.listenTo(this.model, "request", this.loadSpinner);
        },
        nitChanged: function(e) {
            console.log("Documento cambio");
        },
        onStore: function(e) {
            if (!e.isDefaultPrevented()) {
                e.preventDefault();
                var data = window.Misc.formToJson(e.target);
                this.model.save(data, {
                    patch: !0
                });
            }
        },
        loadSpinner: function(model, xhr, opts) {
            window.Misc.setSpinner(this.el);
        },
        responseServer: function(model, resp, opts) {
            window.Misc.removeSpinner(this.el);
            var text = resp.success ? "" : resp.errors;
            if (_.isObject(resp.errors) && (text = window.Misc.parseErrors(resp.errors)), !resp.success) return void alertify.error(text);
            var _this = this, stuffToDo = {
                toEdit: function() {
                    window.Misc.successRedirect(_this.msgSuccess, window.Misc.urlFull(Route.route("terceros.edit", {
                        terceros: resp.id
                    })));
                },
                "default": function() {
                    alertify.success(_this.msgSuccess);
                }
            };
            stuffToDo[this.parameters.callback] ? stuffToDo[this.parameters.callback]() : stuffToDo["default"]();
        }
    });
}(jQuery, this, this.document), app || (app = {}), function($, window, document, undefined) {
    app.MainTerceroView = Backbone.View.extend({
        el: "#terceros-main",
        initialize: function() {
            this.$tercerosSearchTable = this.$("#terceros-search-table"), this.$tercerosSearchTable.DataTable({
                dom: "<'row'<'col-sm-4'B><'col-sm-4 text-center'l><'col-sm-4'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",
                processing: !0,
                serverSide: !0,
                language: window.Misc.dataTableES(),
                ajax: window.Misc.urlFull(Route.route("terceros.index")),
                columns: [ {
                    data: "tercero_nit",
                    name: "tercero_nit"
                }, {
                    data: "tercero_razonsocial",
                    name: "tercero_razonsocial"
                }, {
                    data: "tercero_nombre1",
                    name: "tercero_nombre1"
                }, {
                    data: "tercero_nombre2",
                    name: "tercero_nombre2"
                }, {
                    data: "tercero_apellido1",
                    name: "tercero_apellido1"
                }, {
                    data: "tercero_apellido2",
                    name: "tercero_apellido2"
                } ],
                buttons: [ {
                    text: '<i class="fa fa-user-plus"></i> Nuevo tercero',
                    className: "btn-sm",
                    action: function(e, dt, node, config) {
                        window.Misc.redirect(window.Misc.urlFull(Route.route("terceros.create")));
                    }
                } ],
                columnDefs: [ {
                    targets: 0,
                    render: function(data, type, full, row) {
                        return '<a href="' + window.Misc.urlFull(Route.route("terceros.show", {
                            terceros: full.id
                        })) + '">' + data + "</a>";
                    }
                } ]
            });
        }
    });
}(jQuery, this, this.document), app || (app = {}), function($, window, document, undefined) {
    app.AppRouter = new (Backbone.Router.extend({
        routes: {
            "login(/)": "getLogin",
            "terceros(/)": "getTercerosMain",
            "terceros/create(/)": "getTercerosCreate",
            "terceros/:tercero/edit(/)": "getTercerosEdit",
            "municipios(/)": "getMunicipiosMain",
            "departamentos(/)": "getDepartamentosMain",
            "actividades(/)": "getActividadesMain"
        },
        initialize: function(opts) {
            this.componentAddressView = new app.ComponentAddressView();
        },
        start: function() {
            var config = {
                pushState: !0
            };
            "-1" != document.domain.search("localhost") && (config.root = "/vaziko/public/"), 
            Backbone.history.start(config);
        },
        getLogin: function() {
            this.loginView instanceof Backbone.View && (this.loginView.stopListening(), this.loginView.undelegateEvents()), 
            this.loginView = new app.UserLoginView();
        },
        getTercerosMain: function() {
            this.mainTerceroView instanceof Backbone.View && (this.mainTerceroView.stopListening(), 
            this.mainTerceroView.undelegateEvents()), this.mainTerceroView = new app.MainTerceroView();
        },
        getTercerosCreate: function() {
            this.terceroModel = new app.TerceroModel(), this.createTerceroView instanceof Backbone.View && (this.createTerceroView.stopListening(), 
            this.createTerceroView.undelegateEvents()), this.createTerceroView = new app.CreateTerceroView({
                model: this.terceroModel,
                parameters: {
                    callback: "toEdit"
                }
            });
        },
        getTercerosEdit: function(tercero) {
            this.terceroModel = new app.TerceroModel(), this.terceroModel.set({
                id: tercero
            }, {
                silent: !0
            }), this.createTerceroView instanceof Backbone.View && (this.createTerceroView.stopListening(), 
            this.createTerceroView.undelegateEvents()), this.createTerceroView = new app.CreateTerceroView({
                model: this.terceroModel
            });
        },
        getMunicipiosMain: function() {
            this.mainMunicipioView instanceof Backbone.View && (this.mainMunicipioView.stopListening(), 
            this.mainMunicipioView.undelegateEvents()), this.mainMunicipioView = new app.MainMunicipioView();
        },
        getDepartamentosMain: function() {
            this.mainDepartamentoView instanceof Backbone.View && (this.mainDepartamentoView.stopListening(), 
            this.mainDepartamentoView.undelegateEvents()), this.mainDepartamentoView = new app.MainDepartamentoView();
        },
        getActividadesMain: function() {
            this.mainActividadView instanceof Backbone.View && (this.mainActividadView.stopListening(), 
            this.mainActividadView.undelegateEvents()), this.mainActividadView = new app.MainActividadView();
        }
    }))();
}(jQuery, this, this.document);

var app = app || {};

!function($, window, document, undefined) {
    var InitComponent = function() {
        $.ajaxSetup({
            cache: !1,
            headers: {
                "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
            }
        }), $(document).ajaxStart(function() {
            Pace.restart();
        });
    };
    InitComponent.prototype = {
        initialize: function() {
            this.initApp(), this.initICheck(), this.initAlertify(), this.initInputMask(), this.initSelect2();
        },
        initApp: function() {
            window.app.AppRouter.start();
        },
        initICheck: function() {
            $("input").iCheck({
                checkboxClass: "icheckbox_minimal-green",
                radioClass: "iradio_minimal-green"
            });
        },
        initAlertify: function() {
            alertify.logPosition("bottom right");
        },
        initInputMask: function() {
            $("[data-mask]").inputmask();
        },
        initSelect2: function() {
            $(".select2-default").select2({
                language: "es",
                placeholder: "Seleccione"
            });
        }
    }, $(function() {
        window.initComponent = new InitComponent(), window.initComponent.initialize();
    });
}(jQuery, this, this.document);