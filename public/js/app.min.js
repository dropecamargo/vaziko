/*! koi-frontend - v1.0.0 - 2016-04-01 */
!function(a,b,c,d){var e=function(a){};e.prototype={initialize:function(){},formToJson:function(b){var c={},e=[];return e=a.prototype.isPrototypeOf(b)?b.serializeArray():a(b).serializeArray(),a.each(e,function(){c[this.name]!==d?(c[this.name].push||(c[this.name]=[c[this.name]]),c[this.name].push(this.value||"")):c[this.name]=this.value||""}),c},isUrl:function(a){var b=/^(http[s]?:\/\/(www\.)?|ftp:\/\/(www\.)?|www\.){1}([0-9A-Za-z-\.@:%_\+~#=]+)+(\/(.)*)?(\?(.)*)?/i;return b.test(a)},urlFull:function(a){if(!this.isUrl(c.url))return a;a||(a="");var b=/^\//;return b.test(a)||(a="/"+a),c.url+a},parseErrors:function(b){var c="";if(_.isObject(b)){var d="<ul>";a.each(b,function(a,b){d+="<li>"+b[0]+"</li>"}),d+="</ul>",c=d}return c},setSpinner:function(b){b&&a(b).prepend('<div class="overlay"><i class="fa fa-refresh fa-spin"></i></div>')},removeSpinner:function(b){var c=a(b).find(".overlay");c.length&&c.remove()},dataTableES:function(){return{sProcessing:'<div class="overlay"><i class="fa fa-refresh fa-spin"></i></div>',sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}}},redirect:function(a){a!==d&&""!=a?b.location=a:b.location.reload()},successRedirect:function(a,c){alertify.success(a),setTimeout(function(){b.Misc.redirect(c)},500)}},b.Misc=new e,b.Misc.initialize()}(jQuery,this,this.document),app||(app={}),function(a,b,c){app.ContactoModel=Backbone.Model.extend({urlRoot:function(){return a.Misc.urlFull(Route.route("terceros.index"))},idAttribute:"id",defaults:{}})}(this,this.document),app||(app={}),function(a,b,c){app.TerceroModel=Backbone.Model.extend({urlRoot:function(){return a.Misc.urlFull(Route.route("terceros.index"))},idAttribute:"id",defaults:{}})}(this,this.document),app||(app={}),function(a,b,c,d){app.MainActividadView=Backbone.View.extend({el:"#actividades-main",initialize:function(){this.$actividadesSearchTable=this.$("#actividades-search-table"),this.$actividadesSearchTable.DataTable({processing:!0,serverSide:!0,language:b.Misc.dataTableES(),ajax:b.Misc.urlFull(Route.route("actividades.index")),columns:[{data:"actividad_codigo",name:"actividad_codigo"},{data:"actividad_nombre",name:"actividad_nombre"},{data:"actividad_categoria",name:"actividad_categoria"},{data:"actividad_tarifa",name:"actividad_tarifa"}]})}})}(jQuery,this,this.document),app||(app={}),function(a,b,c,d){app.ComponentAddressView=Backbone.View.extend({el:"body",template:_.template(a("#koi-address-component-tpl").html()||""),events:{"click .btn-address-koi-component":"focusComponent","submit #form-address-component":"addAddress","change select#koi_nomenclatura1":"nomenclatura1Changed","change input#koi_numero1":"numero1Changed","change select#koi_alfabeto1":"alfabeto1Changed","change select#koi_bis":"bisChanged","change select#koi_alfabeto2":"alfabeto2Changed","change select#koi_cardinales1":"cardinales1Changed","change input#koi_numero2":"numero2Changed","change select#koi_alfabeto3":"alfabeto3Changed","change input#koi_numero3":"numero3Changed","change select#koi_cardinales2":"cardinales2Changed","click .btn-address-component-add-complement":"addComplement","click .btn-address-component-remove-item":"removeItem"},initialize:function(){this.$modalComponent=this.$("#modal-address-component")},focusComponent:function(b){a("#"+a(b.currentTarget).attr("data-field")).focus()},addressChanged:function(c){this.inputContent=a(c.currentTarget),this.$modalComponent.find(".content-modal").html(this.template({})),this.$addressField=this.$modalComponent.find("#koi_direccion"),this.$postalField=this.$modalComponent.find("#koi_postal"),this.$formComponent=this.$modalComponent.find("#form-address-component"),this.addressData=new Array(10),"function"==typeof b.initComponent.initSelect2&&b.initComponent.initSelect2(),"function"==typeof b.initComponent.initToUpper&&b.initComponent.initToUpper(),this.$formComponent.validator(),this.$modalComponent.modal("show")},addAddress:function(a){a.isDefaultPrevented()||(a.preventDefault(),this.inputContent.val(this.$addressField.val()),this.$modalComponent.modal("hide"))},nomenclatura1Changed:function(b){this.addressData[0]=a(b.currentTarget).val(),this.buildAddress()},numero1Changed:function(b){this.addressData[1]=a(b.currentTarget).val().trim(),this.buildAddress()},alfabeto1Changed:function(b){this.addressData[2]=a(b.currentTarget).val(),this.buildAddress()},bisChanged:function(b){this.addressData[3]=a(b.currentTarget).val(),this.buildAddress()},alfabeto2Changed:function(b){this.addressData[4]=a(b.currentTarget).val(),this.buildAddress()},cardinales1Changed:function(b){this.addressData[5]=a(b.currentTarget).val(),this.buildAddress()},numero2Changed:function(b){this.addressData[6]=a(b.currentTarget).val().trim(),this.buildAddress()},alfabeto3Changed:function(b){this.addressData[7]=a(b.currentTarget).val(),this.buildAddress()},numero3Changed:function(b){this.addressData[8]=a(b.currentTarget).val().trim(),this.buildAddress()},cardinales2Changed:function(b){this.addressData[9]=a(b.currentTarget).val(),this.buildAddress()},addComplement:function(a){a.preventDefault(),_.isUndefined(this.$("#koi_complementos1").val())||_.isNull(this.$("#koi_complementos1").val())||""==this.$("#koi_complementos1").val()||(this.addressData.push(this.$("#koi_complementos1").val()),_.isUndefined(this.$("#koi_complementos2").val())||_.isNull(this.$("#koi_complementos2").val())||""==this.$("#koi_complementos2").val()||this.addressData.push(this.$("#koi_complementos2").val()),this.$("#koi_complementos1").val(""),this.$("#koi_complementos2").val(""),this.buildAddress())},removeItem:function(a){a.preventDefault(),this.addressData.pop(),this.buildAddress()},buildAddress:function(){var b=a.grep(this.addressData,Boolean).join(" ").trim();this.$addressField.val(b)}})}(jQuery,this,this.document),app||(app={}),function(a,b,c,d){app.MainDepartamentoView=Backbone.View.extend({el:"#departamentos-main",initialize:function(){this.$departamentosSearchTable=this.$("#departamentos-search-table"),this.$departamentosSearchTable.DataTable({processing:!0,serverSide:!0,language:b.Misc.dataTableES(),ajax:b.Misc.urlFull(Route.route("departamentos.index")),columns:[{data:"departamento_codigo",name:"departamento_codigo"},{data:"departamento_nombre",name:"departamento_nombre"}]})}})}(jQuery,this,this.document),app||(app={}),function(a,b,c,d){app.UserLoginView=Backbone.View.extend({el:"#login-box",initialize:function(){this.$loginForm=a("#form-login-account"),this.$loginForm.validator()},render:function(){}})}(jQuery,this,this.document),app||(app={}),function(a,b,c,d){app.MainMunicipioView=Backbone.View.extend({el:"#municipios-main",initialize:function(){this.$municipiosSearchTable=this.$("#municipios-search-table"),this.$municipiosSearchTable.DataTable({processing:!0,serverSide:!0,language:b.Misc.dataTableES(),ajax:b.Misc.urlFull(Route.route("municipios.index")),columns:[{data:"departamento_codigo",name:"koi_departamento.departamento_codigo"},{data:"departamento_nombre",name:"departamento_nombre"},{data:"municipio_codigo",name:"municipio_codigo"},{data:"municipio_nombre",name:"municipio_nombre"}]})}})}(jQuery,this,this.document),app||(app={}),function(a,b,c,d){app.CreateTerceroView=Backbone.View.extend({el:"#tercero-create",templateName:_.template(a("#name-partner-tpl").html()||""),events:{"change input#tercero_nit":"nitChanged","change select#tercero_persona":"personaChanged","change select#tercero_actividad":"actividadChanged","submit #form-create-tercero":"onStore"},parameters:{callback:""},initialize:function(b){b!==d&&_.isObject(b.parameters)&&(this.parameters=a.extend({},this.parameters,b.parameters)),this.msgSuccess="Tercero guardado con exito!",this.$dv=this.$("#tercero_digito"),this.$documento=this.$("#tercero_tipo"),this.$persona=this.$("#tercero_persona"),this.$retecree=this.$("#tercero_retecree"),this.listenTo(this.model,"sync",this.responseServer),this.listenTo(this.model,"request",this.loadSpinner)},render:function(){this.$persona.change()},nitChanged:function(c){var d=this;a.ajax({url:b.Misc.urlFull(Route.route("terceros.dv")),type:"GET",data:{tercero_nit:a(c.currentTarget).val()},beforeSend:function(){d.clearNitChange(),b.Misc.setSpinner(d.el)}}).done(function(a){b.Misc.removeSpinner(d.el),a.success&&(d.$dv.val(a.dv),_.isUndefined(a.documento)||_.isNull(a.documento)||d.$documento.val(a.documento),_.isUndefined(a.persona)||_.isNull(a.persona)||d.$persona.val(a.persona).change())}).fail(function(a,c,e){b.Misc.removeSpinner(d.el),alertify.error(e)})},clearNitChange:function(){this.$dv.val(""),this.$documento.val(""),this.$persona.val("")},personaChanged:function(c){this.$("#name-partner-content").html(this.templateName({persona:a(c.currentTarget).val()})),"function"==typeof b.initComponent.initToUpper&&b.initComponent.initToUpper()},actividadChanged:function(c){var d=this;a.ajax({url:b.Misc.urlFull(Route.route("terceros.rcree")),type:"GET",data:{tercero_actividad:a(c.currentTarget).val()},beforeSend:function(){b.Misc.setSpinner(d.el)}}).done(function(a){b.Misc.removeSpinner(d.el),a.success&&(_.isUndefined(a.rcree)||_.isNull(a.rcree)||d.$retecree.html(a.rcree))}).fail(function(a,c,e){b.Misc.removeSpinner(d.el),alertify.error(e)})},onStore:function(a){if(!a.isDefaultPrevented()){a.preventDefault();var c=b.Misc.formToJson(a.target);this.model.save(c,{patch:!0})}},loadSpinner:function(a,c,d){b.Misc.setSpinner(this.el)},responseServer:function(a,c,d){b.Misc.removeSpinner(this.el);var e=c.success?"":c.errors;if(_.isObject(c.errors)&&(e=b.Misc.parseErrors(c.errors)),!c.success)return void alertify.error(e);var f=this,g={toEdit:function(){b.Misc.successRedirect(f.msgSuccess,b.Misc.urlFull(Route.route("terceros.edit",{terceros:c.id})))},"default":function(){alertify.success(f.msgSuccess)}};g[this.parameters.callback]?g[this.parameters.callback]():g["default"]()}})}(jQuery,this,this.document),app||(app={}),function(a,b,c,d){app.MainTerceroView=Backbone.View.extend({el:"#terceros-main",initialize:function(){this.$tercerosSearchTable=this.$("#terceros-search-table"),this.$tercerosSearchTable.DataTable({dom:"<'row'<'col-sm-4'B><'col-sm-4 text-center'l><'col-sm-4'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>",processing:!0,serverSide:!0,language:b.Misc.dataTableES(),ajax:b.Misc.urlFull(Route.route("terceros.index")),columns:[{data:"tercero_nit",name:"tercero_nit"},{data:"tercero_razonsocial",name:"tercero_razonsocial"},{data:"tercero_nombre1",name:"tercero_nombre1"},{data:"tercero_nombre2",name:"tercero_nombre2"},{data:"tercero_apellido1",name:"tercero_apellido1"},{data:"tercero_apellido2",name:"tercero_apellido2"}],buttons:[{text:'<i class="fa fa-user-plus"></i> Nuevo tercero',className:"btn-sm",action:function(a,c,d,e){b.Misc.redirect(b.Misc.urlFull(Route.route("terceros.create")))}}],columnDefs:[{targets:0,render:function(a,c,d,e){return'<a href="'+b.Misc.urlFull(Route.route("terceros.show",{terceros:d.id}))+'">'+a+"</a>"}}]})}})}(jQuery,this,this.document),app||(app={}),function(a,b,c){app.ContactsList=Backbone.Collection.extend({url:function(){return a.Misc.urlFull(Route.route("terceros.index"))},model:app.AttachmentModel,initialize:function(){}})}(this,this.document),app||(app={}),function(a,b,c,d){app.AppRouter=new(Backbone.Router.extend({routes:{"login(/)":"getLogin","terceros(/)":"getTercerosMain","terceros/create(/)":"getTercerosCreate","terceros/:tercero/edit(/)":"getTercerosEdit","municipios(/)":"getMunicipiosMain","departamentos(/)":"getDepartamentosMain","actividades(/)":"getActividadesMain"},initialize:function(a){this.componentAddressView=new app.ComponentAddressView},start:function(){var a={pushState:!0};"-1"!=c.domain.search("localhost")&&(a.root="/vaziko/public/"),Backbone.history.start(a)},getLogin:function(){this.loginView instanceof Backbone.View&&(this.loginView.stopListening(),this.loginView.undelegateEvents()),this.loginView=new app.UserLoginView},getTercerosMain:function(){this.mainTerceroView instanceof Backbone.View&&(this.mainTerceroView.stopListening(),this.mainTerceroView.undelegateEvents()),this.mainTerceroView=new app.MainTerceroView},getTercerosCreate:function(){this.terceroModel=new app.TerceroModel,this.createTerceroView instanceof Backbone.View&&(this.createTerceroView.stopListening(),this.createTerceroView.undelegateEvents()),this.createTerceroView=new app.CreateTerceroView({model:this.terceroModel,parameters:{callback:"toEdit"}}),this.createTerceroView.render()},getTercerosEdit:function(a){this.terceroModel=new app.TerceroModel,this.terceroModel.set({id:a},{silent:!0}),this.createTerceroView instanceof Backbone.View&&(this.createTerceroView.stopListening(),this.createTerceroView.undelegateEvents()),this.createTerceroView=new app.CreateTerceroView({model:this.terceroModel}),this.createTerceroView.render()},getMunicipiosMain:function(){this.mainMunicipioView instanceof Backbone.View&&(this.mainMunicipioView.stopListening(),this.mainMunicipioView.undelegateEvents()),this.mainMunicipioView=new app.MainMunicipioView},getDepartamentosMain:function(){this.mainDepartamentoView instanceof Backbone.View&&(this.mainDepartamentoView.stopListening(),this.mainDepartamentoView.undelegateEvents()),this.mainDepartamentoView=new app.MainDepartamentoView},getActividadesMain:function(){this.mainActividadView instanceof Backbone.View&&(this.mainActividadView.stopListening(),this.mainActividadView.undelegateEvents()),this.mainActividadView=new app.MainActividadView}}))}(jQuery,this,this.document);var app=app||{};!function(a,b,c,d){var e=function(){a.ajaxSetup({cache:!1,headers:{"X-CSRF-TOKEN":a('meta[name="csrf-token"]').attr("content")}})};e.prototype={initialize:function(){this.initApp(),this.initICheck(),this.initAlertify(),this.initInputMask(),this.initSelect2(),this.initToUpper()},initApp:function(){b.app.AppRouter.start()},initICheck:function(){a("input").iCheck({checkboxClass:"icheckbox_minimal-green",radioClass:"iradio_minimal-green"})},initAlertify:function(){alertify.logPosition("bottom right")},initInputMask:function(){a("[data-mask]").inputmask()},initSelect2:function(){a(".select2-default").select2({language:"es",placeholder:"Seleccione"})},initToUpper:function(){a(".input-toupper").keyup(function(){a(this).val(a(this).val().toUpperCase())})}},a(function(){b.initComponent=new e,b.initComponent.initialize()})}(jQuery,this,this.document);